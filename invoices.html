<!DOCTYPE html>
<html lang="ar">
  <head>
    <meta charset="utf-8" />
    <title>نظام إدارة الفواتير - Invoice Management System</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="shortcut icon" href="7da0182d-1b3e-404e-8fb9-27f47dbd6113.jfif""
    type="image/x-icon">
    <link rel="stylesheet" href="style.css" />
    <script src="script.js" defer></script>
  </head>
  <body>
    <!-- Alert Container -->
    <div id="alertContainer"></div>

    <div class="app">
      <div class="header">
        <div class="language-switcher">
          <button class="lang-btn" onclick="changeLanguage('ar')" id="arBtn">
            <i class="fas fa-globe"></i> العربية
          </button>
          <button class="lang-btn" onclick="changeLanguage('en')" id="enBtn">
            <i class="fas fa-globe"></i> English
          </button>
        </div>
        <h1>
          <i class="fas fa-file-invoice"></i>
          <span data-translate="app_title">نظام إدارة الفواتير</span>
        </h1>
        <p data-translate="app_subtitle">
          نظام شامل لإدارة الفواتير والعملاء والمنتجات
        </p>
      </div>

      <div class="nav-tabs">
        <button class="nav-tab active" onclick="showTab('dashboard')">
          <i class="fas fa-tachometer-alt"></i>
          <span data-translate="dashboard">لوحة التحكم</span>
        </button>
        <button class="nav-tab" onclick="showTab('invoices')">
          <i class="fas fa-file-invoice"></i>
          <span data-translate="invoices">الفواتير</span>
        </button>
        <button class="nav-tab" onclick="showTab('products')">
          <i class="fas fa-box"></i>
          <span data-translate="products">المنتجات</span>
        </button>
        <button class="nav-tab" onclick="showTab('customers')">
          <i class="fas fa-users"></i>
          <span data-translate="customers">العملاء</span>
        </button>
        <button class="nav-tab" onclick="showTab('settings')">
          <i class="fas fa-cog"></i>
          <span data-translate="settings">الإعدادات</span>
        </button>
      </div>

      <div class="tab-content">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-panel active">
          <h2>
            <i class="fas fa-chart-bar"></i>
            <span data-translate="quick_stats">إحصائيات سريعة</span>
          </h2>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-number" id="totalInvoices">0</div>
              <div class="stat-label" data-translate="total_invoices">
                إجمالي الفواتير
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="totalRevenue">0</div>
              <div class="stat-label" data-translate="total_revenue">
                إجمالي الإيرادات
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="totalCustomers">0</div>
              <div class="stat-label" data-translate="total_customers">
                إجمالي العملاء
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="totalProducts">0</div>
              <div class="stat-label" data-translate="total_products">
                إجمالي المنتجات
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <h3 data-translate="recent_invoices">أحدث الفواتير</h3>
              <div id="recentInvoices"></div>
            </div>
            <div class="col">
              <h3 data-translate="top_customers">أفضل العملاء</h3>
              <div id="topCustomers"></div>
            </div>
          </div>
        </div>

        <!-- Invoices Tab -->
        <div id="invoices" class="tab-panel">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 20px;
            "
          >
            <h2>
              <i class="fas fa-file-invoice"></i>
              <span data-translate="invoice_management">إدارة الفواتير</span>
            </h2>
            <button class="btn btn-primary" onclick="openInvoiceModal()">
              <i class="fas fa-plus"></i>
              <span data-translate="new_invoice">فاتورة جديدة</span>
            </button>
          </div>

          <div class="search-box">
            <input
              type="text"
              id="invoiceSearch"
              placeholder="البحث في الفواتير..."
              onkeyup="filterInvoices()"
            />
            <i class="fas fa-search"></i>
          </div>

          <div id="invoicesList"></div>
        </div>

        <!-- Products Tab -->
        <div id="products" class="tab-panel">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 20px;
            "
          >
            <h2>
              <i class="fas fa-box"></i>
              <span data-translate="product_management">إدارة المنتجات</span>
            </h2>
            <button class="btn btn-primary" onclick="openProductModal()">
              <i class="fas fa-plus"></i>
              <span data-translate="new_product">منتج جديد</span>
            </button>
          </div>

          <div class="search-box">
            <input
              type="text"
              id="productSearch"
              placeholder="البحث في المنتجات..."
              onkeyup="filterProducts()"
            />
            <i class="fas fa-search"></i>
          </div>

          <div id="productsList"></div>
        </div>

        <!-- Customers Tab -->
        <div id="customers" class="tab-panel">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 20px;
            "
          >
            <h2>
              <i class="fas fa-users"></i>
              <span data-translate="customer_management">إدارة العملاء</span>
            </h2>
            <button class="btn btn-primary" onclick="openCustomerModal()">
              <i class="fas fa-plus"></i>
              <span data-translate="new_customer">عميل جديد</span>
            </button>
          </div>

          <div class="search-box">
            <input
              type="text"
              id="customerSearch"
              placeholder="البحث في العملاء..."
              onkeyup="filterCustomers()"
            />
            <i class="fas fa-search"></i>
          </div>

          <div id="customersList"></div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-panel">
          <h2>
            <i class="fas fa-cog"></i>
            <span data-translate="company_settings">إعدادات الشركة</span>
          </h2>

          <div class="row">
            <div class="col">
              <div class="form-group">
                <label data-translate="company_name"
                  >اسم الشركة <span class="required">*</span></label
                >
                <input
                  type="text"
                  id="companyName"
                  placeholder="اسم الشركة"
                  required
                />
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label data-translate="company_phone">رقم الهاتف</label>
                <input type="text" id="companyPhone" placeholder="رقم الهاتف" />
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <div class="form-group">
                <label data-translate="company_email">البريد الإلكتروني</label>
                <input
                  type="email"
                  id="companyEmail"
                  placeholder="البريد الإلكتروني"
                />
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label data-translate="company_website"
                  >الموقع الإلكتروني</label
                >
                <input
                  type="text"
                  id="companyWebsite"
                  placeholder="الموقع الإلكتروني"
                />
              </div>
            </div>
          </div>

          <div class="form-group">
            <label data-translate="company_address"
              >عنوان الشركة <span class="required">*</span></label
            >
            <textarea
              id="companyAddress"
              placeholder="عنوان الشركة الكامل"
              rows="3"
              required
            ></textarea>
          </div>

          <div class="row">
            <div class="col">
              <div class="form-group">
                <label data-translate="default_tax_rate">
                  نسبة الضريبة الافتراضية (%)
                  <span class="required">*</span></label
                >
                <input
                  type="number"
                  id="defaultTaxRate"
                  step="0.01"
                  value="14"
                  required
                  min="0"
                  max="100"
                />
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label data-translate="invoice_currency"
                  >عملة الفاتورة <span class="required">*</span></label
                >
                <select id="defaultCurrency" required>
                  <option value="AED" data-translate="aed">
                    درهم إماراتي (AED)
                  </option>
                  <option value="USD" data-translate="usd">
                    دولار أمريكي (USD)
                  </option>
                  <option value="EUR" data-translate="eur">يورو (EUR)</option>
                  <option value="SAR" data-translate="sar">
                    ريال سعودي (SAR)
                  </option>
                </select>
              </div>
            </div>
          </div>

          <button class="btn btn-success" onclick="saveSettings()">
            <i class="fas fa-save"></i>
            <span data-translate="save_settings">حفظ الإعدادات</span>
          </button>

          <button class="btn btn-outline" onclick="exportData()">
            <i class="fas fa-download"></i>
            <span data-translate="export_data">تصدير البيانات</span>
          </button>

          <button class="btn btn-outline" onclick="importData()">
            <i class="fas fa-upload"></i>
            <span data-translate="import_data">استيراد البيانات</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Invoice Modal -->
    <div id="invoiceModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('invoiceModal')">&times;</span>
        <h2><i class="fas fa-file-invoice"></i> فاتورة جديدة</h2>

        <div class="row">
          <div class="col">
            <div class="form-group">
              <label>رقم الفاتورة</label>
              <input type="text" id="invoiceNumber" readonly />
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <label>تاريخ الفاتورة <span class="required">*</span></label>
              <input type="date" id="invoiceDate" required />
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>العميل <span class="required">*</span></label>
          <select id="invoiceCustomer" required>
            <option value="">اختر عميل...</option>
          </select>
        </div>

        <div class="form-group">
          <label>طريقة الدفع <span class="required">*</span></label>
          <select id="paymentMethod" required>
            <option value="cash">نقداً</option>
            <option value="card">بطاقة ائتمان</option>
            <option value="bank">تحويل بنكي</option>
            <option value="check">شيك</option>
          </select>
        </div>

        <div class="form-group">
          <label>أيام الاستحقاق <span class="required">*</span></label>
          <input type="number" id="dueDays" value="30" min="1" required />
        </div>

        <h3>عناصر الفاتورة</h3>
        <div id="invoiceItems">
          <div class="invoice-item">
            <div class="row">
              <div class="col-3">
                <label>المنتج/الخدمة</label>
                <select class="item-product" onchange="updateItemPrice(this)">
                  <option value="">اختر منتج...</option>
                </select>
              </div>
              <div class="col">
                <label>الكمية</label>
                <input
                  type="number"
                  class="item-quantity"
                  value="1"
                  min="1"
                  onchange="calculateItemTotal(this)"
                />
              </div>
              <div class="col">
                <label>السعر</label>
                <input
                  type="number"
                  class="item-price"
                  step="0.01"
                  onchange="calculateItemTotal(this)"
                />
              </div>
              <div class="col">
                <label>الإجمالي</label>
                <input type="number" class="item-total" step="0.01" readonly />
              </div>
              <div class="col">
                <button class="btn btn-danger" onclick="removeItem(this)">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <button class="btn btn-secondary" onclick="addInvoiceItem()">
          <i class="fas fa-plus"></i> إضافة عنصر
        </button>

        <div class="row" style="margin-top: 20px">
          <div class="col">
            <div class="form-group">
              <label>نسبة الضريبة (%) <span class="required">*</span></label>
              <input
                type="number"
                id="invoiceTaxRate"
                step="0.01"
                value="14"
                min="0"
                max="100"
                onchange="calculateInvoiceTotal()"
                required
              />
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <label>خصم (%)</label>
              <input
                type="number"
                id="invoiceDiscount"
                step="0.01"
                value="0"
                min="0"
                max="100"
                onchange="calculateInvoiceTotal()"
              />
            </div>
          </div>
        </div>

        <div
          style="
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
          "
        >
          <div style="display: flex; justify-content: space-between">
            <span>المجموع الفرعي:</span>
            <span id="subtotal">0.00</span>
          </div>
          <div style="display: flex; justify-content: space-between">
            <span>الخصم:</span>
            <span id="discountAmount">0.00</span>
          </div>
          <div style="display: flex; justify-content: space-between">
            <span>الضريبة:</span>
            <span id="taxAmount">0.00</span>
          </div>
          <div
            style="
              display: flex;
              justify-content: space-between;
              font-weight: bold;
              font-size: 1.2em;
            "
          >
            <span>المجموع الكلي:</span>
            <span id="totalAmount">0.00</span>
          </div>
        </div>

        <div class="form-group">
          <label>ملاحظات</label>
          <textarea
            id="invoiceNotes"
            placeholder="ملاحظات إضافية..."
            rows="3"
          ></textarea>
        </div>

        <div style="margin-top: 20px; text-align: center">
          <button class="btn btn-success" onclick="saveInvoice()">
            <i class="fas fa-save"></i> حفظ الفاتورة
          </button>
          <button class="btn btn-primary" onclick="saveAndPrintInvoice()">
            <i class="fas fa-print"></i> حفظ وطباعة
          </button>
          <button
            class="btn btn-secondary"
            onclick="closeModal('invoiceModal')"
          >
            إلغاء
          </button>
        </div>
      </div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('productModal')">&times;</span>
        <h2><i class="fas fa-box"></i> منتج جديد</h2>

        <div class="form-group">
          <label>اسم المنتج/الخدمة <span class="required">*</span></label>
          <input
            type="text"
            id="productName"
            placeholder="اسم المنتج أو الخدمة"
            required
          />
        </div>

        <div class="form-group">
          <label>وصف المنتج</label>
          <textarea
            id="productDescription"
            placeholder="وصف المنتج..."
            rows="3"
          ></textarea>
        </div>

        <div class="row">
          <div class="col">
            <div class="form-group">
              <label>السعر <span class="required">*</span></label>
              <input
                type="number"
                id="productPrice"
                step="0.01"
                placeholder="0.00"
                required
                min="0"
              />
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <label>الوحدة</label>
              <input
                type="text"
                id="productUnit"
                placeholder="قطعة، كيلو، ساعة..."
              />
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <div class="form-group">
              <label>فئة المنتج</label>
              <input
                type="text"
                id="productCategory"
                placeholder="فئة المنتج"
              />
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <label>الكمية المتاحة</label>
              <input type="number" id="productStock" min="0" placeholder="0" />
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>كود المنتج</label>
          <input
            type="text"
            id="productCode"
            placeholder="كود المنتج (اختياري)"
          />
        </div>

        <div style="margin-top: 20px; text-align: center">
          <button class="btn btn-success" onclick="saveProduct()">
            <i class="fas fa-save"></i> حفظ المنتج
          </button>
          <button
            class="btn btn-secondary"
            onclick="closeModal('productModal')"
          >
            إلغاء
          </button>
        </div>
      </div>
    </div>

    <!-- Customer Modal -->
    <div id="customerModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('customerModal')">&times;</span>
        <h2><i class="fas fa-user"></i> عميل جديد</h2>

        <div class="row">
          <div class="col">
            <div class="form-group">
              <label>اسم العميل/الشركة <span class="required">*</span></label>
              <input
                type="text"
                id="customerName"
                placeholder="اسم العميل أو الشركة"
                required
              />
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <label>نوع العميل</label>
              <select id="customerType">
                <option value="individual">فرد</option>
                <option value="company">شركة</option>
              </select>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <div class="form-group">
              <label>رقم الهاتف</label>
              <input type="text" id="customerPhone" placeholder="رقم الهاتف" />
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <label>البريد الإلكتروني</label>
              <input
                type="email"
                id="customerEmail"
                placeholder="البريد الإلكتروني"
              />
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>العنوان</label>
          <textarea
            id="customerAddress"
            placeholder="عنوان العميل..."
            rows="3"
          ></textarea>
        </div>

        <div class="row">
          <div class="col">
            <div class="form-group">
              <label>رقم الضريبة</label>
              <input
                type="text"
                id="customerTaxNumber"
                placeholder="رقم الضريبة"
              />
            </div>
          </div>
          <div class="col">
            <div class="form-group">
              <label>رقم الهوية/التجاري</label>
              <input
                type="text"
                id="customerIdNumber"
                placeholder="رقم الهوية أو التجاري"
              />
            </div>
          </div>
        </div>

        <div style="margin-top: 20px; text-align: center">
          <button class="btn btn-success" onclick="saveCustomer()">
            <i class="fas fa-save"></i> حفظ العميل
          </button>
          <button
            class="btn btn-secondary"
            onclick="closeModal('customerModal')"
          >
            إلغاء
          </button>
        </div>
      </div>
    </div>

    <!-- Invoice Display -->
    <div id="invoiceDisplay" class="invoice" style="display: none">
      <div class="invoice-header">
        <div class="business-info">
          <div
            style="
              display: flex;
              align-items: center;
              gap: 15px;
              margin-bottom: 15px;
            "
          >
            <img
              src="7da0182d-1b3e-404e-8fb9-27f47dbd6113.jfif"
              alt="Company Logo"
              style="
                width: 80px;
                height: 80px;
                object-fit: contain;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
              "
            />
            <div>
              <h3
                id="displayCompanyName"
                style="margin: 0; font-size: 1.8em; color: #667eea"
              >
                Company Name
              </h3>
              <div
                id="displayCompanyAddress"
                style="color: #6c757d; margin-top: 5px"
              >
                Address
              </div>
            </div>
          </div>
          <div style="display: flex; gap: 20px; flex-wrap: wrap">
            <div>
              <strong>Phone:</strong> <span id="displayCompanyPhone">---</span>
            </div>
            <div>
              <strong>Email:</strong> <span id="displayCompanyEmail">---</span>
            </div>
          </div>
        </div>
        <div class="invoice-meta">
          <h2 style="color: #667eea; margin: 0; text-align: left">
            TAX INVOICE
          </h2>
          <div style="margin-top: 10px; text-align: left">
            <div>
              <strong>Invoice No:</strong>
              <span id="displayInvoiceNumber">---</span>
            </div>
            <div>
              <strong>Date:</strong> <span id="displayInvoiceDate">---</span>
            </div>
            <div>
              <strong>Due Date:</strong> <span id="displayDueDate">---</span>
            </div>
            <div>
              <strong>Payment Method:</strong>
              <span id="displayPaymentMethod">---</span>
            </div>
          </div>
        </div>
      </div>

      <div style="margin: 30px 0">
        <h4 style="text-align: left; margin-bottom: 15px; color: #495057">
          BILL TO:
        </h4>
        <div
          id="displayCustomerInfo"
          style="
            text-align: left;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
          "
        ></div>
      </div>

      <table style="direction: ltr">
        <thead>
          <tr>
            <th style="text-align: left">Description</th>
            <th style="text-align: center">Quantity</th>
            <th style="text-align: center">Unit</th>
            <th style="text-align: center">Price</th>
            <th style="text-align: right">Total</th>
          </tr>
        </thead>
        <tbody id="displayItemsBody"></tbody>
      </table>

      <div style="margin-top: 30px">
        <div style="display: flex; justify-content: flex-end">
          <div style="width: 300px">
            <table style="direction: ltr">
              <tbody>
                <tr>
                  <td style="text-align: right"><strong>Subtotal:</strong></td>
                  <td style="text-align: right" id="displaySubtotal">0.00</td>
                </tr>
                <tr>
                  <td style="text-align: right"><strong>Discount:</strong></td>
                  <td style="text-align: right" id="displayDiscount">0.00</td>
                </tr>
                <tr>
                  <td style="text-align: right"><strong>Tax:</strong></td>
                  <td style="text-align: right" id="displayTax">0.00</td>
                </tr>
                <tr class="total">
                  <td style="text-align: right"><strong>TOTAL:</strong></td>
                  <td style="text-align: right" id="displayTotal">0.00</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div style="margin-top: 30px" id="displayNotes"></div>

      <div
        style="
          margin-top: 30px;
          text-align: center;
          padding: 20px;
          border-top: 2px solid #e9ecef;
        "
      >
        <button class="btn btn-primary" onclick="printInvoice()">
          <i class="fas fa-print"></i> طباعة الفاتورة
        </button>
        <button class="btn btn-secondary" onclick="closeInvoiceDisplay()">
          إغلاق
        </button>
      </div>
    </div>
  </body>
</html>
